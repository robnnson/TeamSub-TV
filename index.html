<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team-Sub Navigator Display</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #002855;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Banner Section */
        .banner-container {
            position: relative;
            width: 100%;
            height: 25%;
            overflow: hidden;
            background: #000;
        }

        /* Clock Display */
        .clock-display {
            position: absolute;
            top: 20px;
            right: 30px;
            background: rgba(0, 40, 85, 0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 10;
            text-align: center;
        }

        .clock-time {
            font-size: 2.5em;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .clock-date {
            font-size: 1.2em;
            font-weight: normal;
            margin-top: 5px;
            opacity: 0.9;
        }

        .banner {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .banner.active {
            opacity: 1;
        }

        .banner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Main Content Grid */
        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 15px;
            padding: 15px;
        }

        /* Info Cards */
        .info-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .info-card h2 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 15px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        /* Rotating Content - Spans 2 rows */
        .rotating-content {
            grid-row: span 2;
            background: white;
            position: relative;
            overflow: hidden;
        }

        .content-slide {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 80px;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            overflow-y: auto;
        }

        .content-slide.active {
            opacity: 1;
        }

        .drive-item {
            background: linear-gradient(to right, #f5f7fa, #c3cfe2);
            padding: 12px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .drive-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .drive-destination {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .drive-time {
            font-size: 1.1em;
            color: #667eea;
            font-weight: bold;
        }

        .drive-arrival {
            font-size: 0.9em;
            color: #666;
        }

        .train-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(to right, #e8f5e9, #c8e6c9);
            border-radius: 8px;
            font-size: 1.1em;
        }

        .train-line {
            font-weight: bold;
            color: #1b5e20;
            min-width: 60px;
        }

        .train-destination {
            flex: 1;
            color: #333;
            margin: 0 10px;
        }

        .train-time {
            color: #667eea;
            font-weight: bold;
            min-width: 60px;
            text-align: right;
        }

        .transit-slide {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 20px;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            overflow: hidden;
        }

        .transit-slide.active {
            opacity: 1;
        }

        /* Announcements Ticker */
        .announcements-ticker {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 40, 85, 0.95);
            color: white;
            padding: 15px 0;
            overflow: hidden;
        }

        .ticker-content {
            display: inline-block;
            white-space: nowrap;
            padding-left: 100%;
            animation: scroll-left 30s linear infinite;
        }

        .ticker-content span {
            font-size: 1.3em;
            margin-right: 50px;
        }

        .ticker-content span::before {
            content: "‚óè ";
            color: #ffffff;
            margin-right: 10px;
        }

        @keyframes scroll-left {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-100%);
            }
        }

        /* Weather Card */
        .weather-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 10px;
        }

        .weather-icon {
            font-size: 5em;
        }

        .weather-details {
            flex: 1;
        }

        .temperature {
            font-size: 3em;
            color: #667eea;
            font-weight: bold;
        }

        .weather-desc {
            font-size: 1.3em;
            color: #666;
        }

        /* Transit Times */
        .transit-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(to right, #f5f7fa, #c3cfe2);
            border-radius: 8px;
            font-size: 1.2em;
        }

        .transit-route {
            font-weight: bold;
            color: #333;
        }

        .transit-time {
            color: #667eea;
            font-weight: bold;
        }

        /* Metro Departures */
        .metro-list {
            max-height: 100%;
            overflow-y: auto;
        }

        .metro-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(to right, #ffeaa7, #fdcb6e);
            border-radius: 8px;
            font-size: 1.1em;
        }

        .metro-line {
            font-weight: bold;
            color: #2d3436;
        }

        .metro-time {
            background: #2d3436;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <!-- Rotating Banner Section -->
    <div class="banner-container">
        <div class="banner active">
            <img src="img/Team-Sub Navigator Banner_JAN-FEB-MAR.jpg" alt="Q1 Banner">
        </div>
        <div class="banner">
            <img src="img/Team-Sub Navigator Banner_APR-MAY-JUN.jpg" alt="Q2 Banner">
        </div>
        <div class="banner">
            <img src="img/Team-Sub Navigator Banner_JUL-AUG-SEP.jpg" alt="Q3 Banner">
        </div>
        <div class="banner">
            <img src="img/Team-Sub Navigator Banner_OCT-NOV-DEC.jpg" alt="Q4 Banner">
        </div>

        <!-- Clock Display -->
        <div class="clock-display">
            <div class="clock-time" id="clock-time">00:00</div>
            <div class="clock-date" id="clock-date">Monday, January 1</div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="main-content">
        <!-- Main Content Area (Left side, spans 2 rows) -->
        <div class="info-card rotating-content">
            <!-- Empty white box for future content -->
            <div style="display: flex; align-items: center; justify-content: center; height: calc(100% - 80px); color: #999; font-size: 1.2rem;">
                Content area available for displays
            </div>

            <!-- Announcements Ticker at bottom -->
            <div class="announcements-ticker">
                <div class="ticker-content">
                    <span>Welcome to Team-Sub Navigator</span>
                    <span>Stay informed with real-time transit updates and weather information</span>
                    <span>Metro Arrivals Updated Every 30s</span>
                    <span>For service alerts and schedule changes, check the transit information panel</span>
                </div>
            </div>
        </div>

        <!-- Weather Card (Top right) -->
        <div class="info-card">
            <h2>Current Weather</h2>
            <div class="weather-info">
                <img id="weather-icon" src="" alt="Weather Icon" style="width: 80px; height: 80px;">
                <div class="weather-details">
                    <div class="temperature" id="weather-temp">--¬∞F</div>
                    <div class="weather-desc" id="weather-desc">Loading...</div>
                    <div style="margin-top: 10px; color: #888;">
                        <span id="weather-humidity">Humidity: --%</span><br>
                        <span id="weather-wind">Wind: -- km/h</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transit Times (Middle right) - Now with rotating content -->
        <div class="info-card" style="position: relative; overflow: hidden;">
            <!-- Metro Slide -->
            <div class="transit-slide active" id="metro-slide">
                <h2>Next Trains - Navy Yard</h2>
                <div style="display: flex; align-items: center; gap: 8px; font-size: 0.95em; color: #888; margin-bottom: 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 18px; height: 18px; fill: #888;">
                        <path d="M13.5 5.5C14.33 5.5 15 4.83 15 4C15 3.17 14.33 2.5 13.5 2.5C12.67 2.5 12 3.17 12 4C12 4.83 12.67 5.5 13.5 5.5ZM9 22V15.5L7 13V8.5H8.5V12L11 14.5V22H9ZM16.75 22L15 14H17L18.75 22H16.75ZM18.5 10C17.67 10 17 10.67 17 11.5C17 12.33 17.67 13 18.5 13C19.33 13 20 12.33 20 11.5C20 10.67 19.33 10 18.5 10Z"/>
                    </svg>
                    <span>14 min walk</span>
                </div>
                <div id="train-list">Loading train data...</div>
            </div>

            <!-- Status Slide -->
            <div class="transit-slide" id="status-slide">
                <h2 style="margin-bottom: 15px;">Status Information</h2>

                <!-- FPCON Status -->
                <div style="background: rgba(255, 255, 255, 0.5); border: 2px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h3 style="font-size: 0.9em; color: #666; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;">Force Protection Condition</h3>
                    <div style="font-size: 2.2em; font-weight: 600; letter-spacing: 1px;" id="fpcon-status">LOADING...</div>
                </div>

                <!-- LAN Status -->
                <div style="background: rgba(255, 255, 255, 0.5); border: 2px solid #ddd; padding: 15px; border-radius: 8px;">
                    <h3 style="font-size: 0.9em; color: #666; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px;">Network Status</h3>
                    <div style="font-size: 2.2em; font-weight: 600; letter-spacing: 1px;" id="lan-status">LOADING...</div>
                </div>
            </div>

            <!-- Driving Times Slide -->
            <div class="transit-slide" id="driving-slide">
                <h2 style="margin-bottom: 15px;">Driving Times</h2>
                <div id="drive-list" style="display: flex; flex-direction: column; gap: 10px; overflow-y: auto; max-height: calc(100% - 50px);">
                    <div>Loading driving times...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Banner rotation
        let currentBanner = 0;
        const banners = document.querySelectorAll('.banner');

        function rotateBanner() {
            banners[currentBanner].classList.remove('active');
            currentBanner = (currentBanner + 1) % banners.length;
            banners[currentBanner].classList.add('active');
        }

        // Rotate banners every 10 seconds
        setInterval(rotateBanner, 10000);

        // Transit slide rotation (metro, status, driving times)
        let currentTransitSlide = 0;
        const transitSlides = document.querySelectorAll('.transit-slide');

        function rotateTransitSlide() {
            transitSlides[currentTransitSlide].classList.remove('active');
            currentTransitSlide = (currentTransitSlide + 1) % transitSlides.length;
            transitSlides[currentTransitSlide].classList.add('active');
        }

        // Rotate transit slides every 10 seconds
        setInterval(rotateTransitSlide, 10000);

        // Real-time clock and date
        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
            const date = now.toLocaleDateString('en-US', {
                weekday: 'long',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('clock-time').textContent = time;
            document.getElementById('clock-date').textContent = date;
        }

        updateClock();
        setInterval(updateClock, 1000);

        // Fetch Weather Data
        async function fetchWeather() {
            try {
                const res = await fetch('https://api.openweathermap.org/data/2.5/weather?q=Washington,DC,US&units=imperial&appid=9fcfc0149fef9015a6eaba1df22caf5b');
                const data = await res.json();
                const temp = Math.round(data.main.temp);
                const desc = data.weather[0].description;
                const iconCode = data.weather[0].icon;
                const humidity = data.main.humidity;
                const windSpeed = Math.round(data.wind.speed * 1.60934); // Convert mph to km/h

                document.getElementById('weather-temp').textContent = `${temp}¬∞F`;
                document.getElementById('weather-desc').textContent = desc.charAt(0).toUpperCase() + desc.slice(1);
                document.getElementById('weather-icon').src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
                document.getElementById('weather-humidity').textContent = `Humidity: ${humidity}%`;
                document.getElementById('weather-wind').textContent = `Wind: ${windSpeed} km/h`;
            } catch (err) {
                console.error('Weather fetch failed:', err);
                document.getElementById('weather-desc').textContent = 'Weather unavailable';
            }
        }

        // Fetch WMATA Train Arrivals
        async function fetchTrainArrivals() {
            const apiKey = 'd1df6a70755d42398beefaf6ee90a662';
            const stationCode = 'F05'; // Navy Yard station
            const url = `https://api.wmata.com/StationPrediction.svc/json/GetPrediction/${stationCode}`;

            try {
                const response = await fetch(url, { headers: { api_key: apiKey } });
                const data = await response.json();
                const trainList = document.getElementById('train-list');
                trainList.innerHTML = '';

                const validTrains = data.Trains.filter(train => {
                    const min = parseInt(train.Min);
                    return !isNaN(min);
                });

                if (validTrains.length > 0) {
                    validTrains.forEach(train => {
                        const div = document.createElement('div');
                        div.className = 'train-item';
                        div.innerHTML = `
                            <span class="train-line">${train.Line}</span>
                            <span class="train-destination">to ${train.Destination}</span>
                            <span class="train-time">${train.Min} min</span>
                        `;
                        trainList.appendChild(div);
                    });
                } else {
                    trainList.innerHTML = '<div style="padding: 12px; color: #666;">No upcoming trains.</div>';
                }
            } catch (err) {
                console.error('Train data fetch failed:', err);
                document.getElementById('train-list').innerHTML = '<div style="padding: 12px; color: #666;">Error loading train data.</div>';
            }
        }

        // Fetch FPCON Status
        async function fetchFpconStatus() {
            try {
                const res = await fetch('OLD/fpcon.json');
                const data = await res.json();
                const status = data.fpcon.toUpperCase();
                const el = document.getElementById('fpcon-status');
                el.textContent = status;

                const colorMap = {
                    NORMAL: '#4caf50',
                    ALPHA: '#03a9f4',
                    BRAVO: '#ffc107',
                    CHARLIE: '#ff5722',
                    DELTA: '#f44336'
                };
                el.style.color = colorMap[status] || '#fff';
            } catch (err) {
                console.error('FPCON fetch failed:', err);
                document.getElementById('fpcon-status').textContent = 'Unavailable';
            }
        }

        // Fetch LAN Status
        async function fetchLANStatus() {
            try {
                const res = await fetch('OLD/lan.json');
                const data = await res.json();
                const status = data.lan.toUpperCase();
                const el = document.getElementById('lan-status');
                el.textContent = status;

                const colorMap = {
                    NORMAL: '#4caf50',
                    DEGRADED: '#ffc107',
                    OUTAGE: '#f44336'
                };
                el.style.color = colorMap[status] || '#fff';
            } catch (err) {
                console.error('LAN status fetch failed:', err);
                document.getElementById('lan-status').textContent = 'Unavailable';
            }
        }

        // Fetch Driving Time
        async function fetchDrivingTime(fromLat, fromLon, toLat, toLon) {
            const key = '5mbANdobpExgtq28V5rxlSylvDx87ulH';
            const url = `https://api.tomtom.com/routing/1/calculateRoute/${fromLat},${fromLon}:${toLat},${toLon}/json?key=${key}&travelMode=car`;

            try {
                const res = await fetch(url);
                const data = await res.json();
                const summary = data.routes?.[0]?.summary;
                const mins = Math.round(summary.travelTimeInSeconds / 60);
                const arrival = new Date(Date.now() + summary.travelTimeInSeconds * 1000);
                return {
                    minutes: mins,
                    arrival: arrival.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })
                };
            } catch (err) {
                console.error('Drive time fetch failed:', err);
                return { minutes: 'N/A', arrival: '‚Äî' };
            }
        }

        // Fetch All Driving Times
        async function fetchAllDrivingTimes() {
            const driveList = document.getElementById('drive-list');
            driveList.innerHTML = '';

            const from = [38.87382041883797, -76.9972499997064];
            const destinations = [
                { name: 'Pentagon', to: [38.868746, -77.056708] },
                { name: 'Joint Base Anacostia-Bolling', to: [38.835532, -76.995000] },
                { name: 'Andrews AFB', to: [38.810794, -76.866222] },
                { name: 'Pax River', to: [38.273144, -76.453244] },
                { name: 'Reston, VA', to: [38.958630, -77.357002] },
            ];

            for (const dest of destinations) {
                const { minutes, arrival } = await fetchDrivingTime(from[0], from[1], dest.to[0], dest.to[1]);
                const div = document.createElement('div');
                div.className = 'drive-item';
                div.innerHTML = `
                    <div class="drive-row">
                        <span class="drive-destination">${dest.name}</span>
                        <span class="drive-time">${minutes} min</span>
                    </div>
                    <div class="drive-arrival">Arrives approx. at ${arrival}</div>
                `;
                driveList.appendChild(div);
            }
        }

        // Initialize all data fetches
        fetchWeather();
        fetchTrainArrivals();
        fetchFpconStatus();
        fetchLANStatus();
        fetchAllDrivingTimes();

        // Set up refresh intervals
        setInterval(fetchWeather, 600000);        // Every 10 minutes
        setInterval(fetchTrainArrivals, 30000);   // Every 30 seconds
        setInterval(fetchFpconStatus, 60000);     // Every 60 seconds
        setInterval(fetchLANStatus, 5000);        // Every 5 seconds
        setInterval(fetchAllDrivingTimes, 300000); // Every 5 minutes
    </script>
</body>
</html>
